# PWN

[TOC]

## ELF

### ELF文件的类型

ELF即”可执行可链接格式“，Linux系统上所运行的就是ELF格式的文件，相关定义在`/usr/include/elf.h`文件里。

ELF文件分为三种类型，可执行文件(.exec)、可重定位文件(.rel)和共享目标文件(.dyn)：

- 可执行文件：经过链接的、可执行的目标文件，通常也被称为程序。
- 可重定位文件：由源文件编译而成且尚未链接的目标文件，通常以.o作为扩展名。用于与其他目标文件进行链接以构成可执行文件或动态链接库，通常是一段位置独立的代码。
- 共享目标文件：动态链接库文件。用于在链接过程中与其他动态链接库或可重定位文件一起构建新的目标文件，或者在可执行文件加载时，链接到进程中作为运行代码的一部分。

除此之外，核心转储文件（core dump file）作为进程意外终止时进程地址空间的转储，也是ELF文件的一种。使用gdb读取这类文件  可以辅助调试和查找程序崩溃的原因。

### ELF文件的结构

通常目标文件都会包含三个节：

- 代码（.text）：用于保存可执行的机器指令，通常设置为只读以防止被改写和利用
- 数据（.data）：用于保存已初始化的全局变量和局部静态变量
- BSS（.bss）：用于保存未初始化的全局变量和局部动态变量

ELF文件头位于目标文件最开始的位置，包含描述整个文件的一些基本信息，例如ELF文件类型、版本、目标机器、程序入口、段表和节表的位置和长度等。文件头部存在魔术字符（7f 45 4c 46），即字符串”\177ELF“，当文件被映射到内存时，可以通过搜索该字符确定映射地址，这在dump内存时非常有用。

节头表保存目标文件的节信息，表的每一项都是一个`Elf64_Shdr`结构体，记录了节的名字、长度、偏移、读写权限等信息。节头表的位置记录在文件头的`e_shoff`域中。节头表对于程序运行并不是必须的，所以常有程序去除节头表以增加反编译器的分析难度。

## Pwntools Usage

## ROP gadget

在栈缓冲区溢出的基础上，利用程序中已有的小片段(gadgets) 来改变某些寄存器或者变量的值，从而控制程序的执行流程。所谓gadgets 就是以ret 结尾的指令序列，通过这些指令序列，我们可以修改某些内存或者寄存器的值。
